import{w as Wt,R as Z,P as J,h as se,i as Y,T as O,b as pt,I as ne,B as jt,u as yt,a as E,D as re,j as ie,M as Q,E as oe,d as B,v as L,C as ae}from"./index-df6cbe0a.js";import{K as he}from"./index-5cfd8b41.js";import{m as ce,c as le,d as ue}from"./mixColors-b0514653.js";import{g as de}from"./getTextureBatchBindGroup-ca62a9b3.js";var fe=xe,gt={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},ye=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function xe(h){var t=[];return h.replace(ye,function(e,s,n){var r=s.toLowerCase();for(n=ge(n),r=="m"&&n.length>2&&(t.push([s].concat(n.splice(0,2))),r="l",s=s=="m"?"l":"L");;){if(n.length==gt[r])return n.unshift(s),t.push(n);if(n.length<gt[r])throw new Error("malformed path data");t.push([s].concat(n.splice(0,gt[r])))}}),t}var pe=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function ge(h){var t=h.match(pe);return t?t.map(Number):[]}const me=he(fe);function _e(h,t){const e=me(h),s=[];let n=null,r=0,i=0;for(let o=0;o<e.length;o++){const c=e[o],l=c[0],a=c;switch(l){case"M":r=a[1],i=a[2],t.moveTo(r,i);break;case"m":r+=a[1],i+=a[2],t.moveTo(r,i);break;case"H":r=a[1],t.lineTo(r,i);break;case"h":r+=a[1],t.lineTo(r,i);break;case"V":i=a[1],t.lineTo(r,i);break;case"v":i+=a[1],t.lineTo(r,i);break;case"L":r=a[1],i=a[2],t.lineTo(r,i);break;case"l":r+=a[1],i+=a[2],t.lineTo(r,i);break;case"C":r=a[5],i=a[6],t.bezierCurveTo(a[1],a[2],a[3],a[4],r,i);break;case"c":t.bezierCurveTo(r+a[1],i+a[2],r+a[3],i+a[4],r+a[5],i+a[6]),r+=a[5],i+=a[6];break;case"S":r=a[3],i=a[4],t.bezierCurveToShort(a[1],a[2],r,i);break;case"s":t.bezierCurveToShort(r+a[1],i+a[2],r+a[3],i+a[4]),r+=a[3],i+=a[4];break;case"Q":r=a[3],i=a[4],t.quadraticCurveTo(a[1],a[2],r,i);break;case"q":t.quadraticCurveTo(r+a[1],i+a[2],r+a[3],i+a[4]),r+=a[3],i+=a[4];break;case"T":r=a[1],i=a[2],t.quadraticCurveToShort(r,i);break;case"t":r+=a[1],i+=a[2],t.quadraticCurveToShort(r,i);break;case"A":r=a[6],i=a[7],t.arcToSvg(a[1],a[2],a[3],a[4],a[5],r,i);break;case"a":r+=a[6],i+=a[7],t.arcToSvg(a[1],a[2],a[3],a[4],a[5],r,i);break;case"Z":case"z":t.closePath(),s.length>0&&(n=s.pop(),n?(r=n.startX,i=n.startY):(r=0,i=0)),n=null;break;default:Wt(`Unknown SVG path command: ${l}`)}l!=="Z"&&l!=="z"&&n===null&&(n={startX:r,startY:i},s.push(n))}return t}class Tt{constructor(t=0,e=0,s=0){this.type="circle",this.x=t,this.y=e,this.radius=s}clone(){return new Tt(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=s}strokeContains(t,e,s){if(this.radius===0)return!1;const n=this.x-t,r=this.y-e,i=this.radius,o=s/2,c=Math.sqrt(n*n+r*r);return c<i+o&&c>i-o}getBounds(t){return t=t||new Z,t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class wt{constructor(t=0,e=0,s=0,n=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=s,this.halfHeight=n}clone(){return new wt(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(t-this.x)/this.halfWidth,n=(e-this.y)/this.halfHeight;return s*=s,n*=n,s+n<=1}strokeContains(t,e,s){const{halfWidth:n,halfHeight:r}=this;if(n<=0||r<=0)return!1;const i=s/2,o=n-i,c=r-i,l=n+i,a=r+i,u=t-this.x,x=e-this.y,y=u*u/(o*o)+x*x/(c*c),f=u*u/(l*l)+x*x/(a*a);return y>1&&f<=1}getBounds(){return new Z(this.x-this.halfWidth,this.y-this.halfHeight,this.halfWidth*2,this.halfHeight*2)}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function be(h,t,e,s,n,r){const i=h-e,o=t-s,c=n-e,l=r-s,a=i*c+o*l,u=c*c+l*l;let x=-1;u!==0&&(x=a/u);let y,f;x<0?(y=e,f=s):x>1?(y=n,f=r):(y=e+x*c,f=s+x*l);const g=h-y,d=t-f;return g*g+d*d}class at{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const s=[];for(let n=0,r=e.length;n<r;n++)s.push(e[n].x,e[n].y);e=s}this.points=e,this.closePath=!0}clone(){const t=this.points.slice(),e=new at(t);return e.closePath=this.closePath,e}contains(t,e){let s=!1;const n=this.points.length/2;for(let r=0,i=n-1;r<n;i=r++){const o=this.points[r*2],c=this.points[r*2+1],l=this.points[i*2],a=this.points[i*2+1];c>e!=a>e&&t<(l-o)*((e-c)/(a-c))+o&&(s=!s)}return s}strokeContains(t,e,s){const n=s/2,r=n*n,{points:i}=this;for(let o=0;o<i.length;o+=2){const c=i[o],l=i[o+1],a=i[(o+2)%i.length],u=i[(o+3)%i.length];if(be(t,e,c,l,a,u)<=r)return!0}return!1}getBounds(t){t=t||new Z;const e=this.points;let s=1/0,n=-1/0,r=1/0,i=-1/0;for(let o=0,c=e.length;o<c;o+=2){const l=e[o],a=e[o+1];s=l<s?l:s,n=l>n?l:n,r=a<r?a:r,i=a>i?a:i}return t.x=s,t.width=n-s,t.y=r,t.height=i-r,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const dt=(h,t,e,s,n,r)=>{const i=h-e,o=t-s,c=Math.sqrt(i*i+o*o);return c>=n-r&&c<=n+r};class vt{constructor(t=0,e=0,s=0,n=0,r=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=s,this.height=n,this.radius=r}getBounds(t){return t=t||new Z,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new vt(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let n=t-(this.x+s),r=e-(this.y+s);const i=s*s;if(n*n+r*r<=i||(n=t-(this.x+this.width-s),n*n+r*r<=i)||(r=e-(this.y+this.height-s),n*n+r*r<=i)||(n=t-(this.x+s),n*n+r*r<=i))return!0}return!1}strokeContains(t,e,s){const{x:n,y:r,width:i,height:o,radius:c}=this,l=s/2,a=n+c,u=r+c,x=i-c*2,y=o-c*2,f=n+i,g=r+o;return(t>=n-l&&t<=n+l||t>=f-l&&t<=f+l)&&e>=u&&e<=u+y||(e>=r-l&&e<=r+l||e>=g-l&&e<=g+l)&&t>=a&&t<=a+x?!0:t<a&&e<u&&dt(t,e,a,u,c,l)||t>f-c&&e<u&&dt(t,e,f-c,u,c,l)||t>f-c&&e>g-c&&dt(t,e,f-c,g-c,c,l)||t<a&&e>g-c&&dt(t,e,a,g-c,c,l)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}function Pe(h,t,e,s,n,r,i,o=null){let c=0;e*=t,n*=r;const l=o.a,a=o.b,u=o.c,x=o.d,y=o.tx,f=o.ty;for(;c<i;){const g=h[e],d=h[e+1];s[n]=l*g+u*d+y,s[n+1]=a*g+x*d+f,n+=r,e+=t,c++}}function Me(h,t,e,s){let n=0;for(t*=e;n<s;)h[t]=0,h[t+1]=0,t+=e,n++}function $t(h,t,e,s,n){const r=t.a,i=t.b,o=t.c,c=t.d,l=t.tx,a=t.ty;e=e||0,s=s||2,n=n||h.length/s-e;let u=e*s;for(let x=0;x<n;x++){const y=h[u],f=h[u+1];h[u]=r*y+o*f+l,h[u+1]=i*y+c*f+a,u+=s}}class Vt{constructor(){this.batcher=null,this.batch=null,this.applyTransform=!0,this.roundPixels=0}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}packIndex(t,e,s){const n=this.geometryData.indices;for(let r=0;r<this.indexSize;r++)t[e++]=n[r+this.indexOffset]+s-this.vertexOffset}packAttributes(t,e,s,n){const r=this.geometryData,i=this.renderable,o=r.vertices,c=r.uvs,l=this.vertexOffset*2,a=(this.vertexOffset+this.vertexSize)*2,u=this.color,x=u>>16|u&65280|(u&255)<<16;if(this.applyTransform){const y=ce(x,i.groupColor)+(this.alpha*i.groupAlpha*255<<24),f=i.groupTransform,g=n<<16|this.roundPixels&65535,d=f.a,b=f.b,p=f.c,M=f.d,P=f.tx,v=f.ty;for(let G=l;G<a;G+=2){const C=o[G],S=o[G+1];t[s]=d*C+p*S+P,t[s+1]=b*C+M*S+v,t[s+2]=c[G],t[s+3]=c[G+1],e[s+4]=y,e[s+5]=g,s+=6}}else{const y=x+(this.alpha*255<<24);for(let f=l;f<a;f+=2)t[s]=o[f],t[s+1]=o[f+1],t[s+2]=c[f],t[s+3]=c[f+1],e[s+4]=y,e[s+5]=n<<16,s+=6}}get vertSize(){return this.vertexSize}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.vertexOffset=this.vertexOffset,t.vertexSize=this.vertexSize,t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData}reset(){this.applyTransform=!0}}const mt={build(h,t){let e,s,n,r,i,o;if(h.type==="circle"){const P=h;e=P.x,s=P.y,i=o=P.radius,n=r=0}else if(h.type==="ellipse"){const P=h;e=P.x,s=P.y,i=P.halfWidth,o=P.halfHeight,n=r=0}else{const P=h,v=P.width/2,G=P.height/2;e=P.x+v,s=P.y+G,i=o=Math.max(0,Math.min(P.radius,Math.min(v,G))),n=v-i,r=G-o}if(!(i>=0&&o>=0&&n>=0&&r>=0))return t;const c=Math.ceil(2.3*Math.sqrt(i+o)),l=c*8+(n?4:0)+(r?4:0);if(l===0)return t;if(c===0)return t[0]=t[6]=e+n,t[1]=t[3]=s+r,t[2]=t[4]=e-n,t[5]=t[7]=s-r,t;let a=0,u=c*4+(n?2:0)+2,x=u,y=l,f=n+i,g=r,d=e+f,b=e-f,p=s+g;if(t[a++]=d,t[a++]=p,t[--u]=p,t[--u]=b,r){const P=s-g;t[x++]=b,t[x++]=P,t[--y]=P,t[--y]=d}for(let P=1;P<c;P++){const v=Math.PI/2*(P/c),G=n+Math.cos(v)*i,C=r+Math.sin(v)*o,S=e+G,m=e-G,_=s+C,D=s-C;t[a++]=S,t[a++]=_,t[--u]=_,t[--u]=m,t[x++]=m,t[x++]=D,t[--y]=D,t[--y]=S}f=n,g=r+o,d=e+f,b=e-f,p=s+g;const M=s-g;return t[a++]=d,t[a++]=p,t[--y]=M,t[--y]=d,n&&(t[a++]=b,t[a++]=p,t[--y]=M,t[--y]=b),t},triangulate(h,t,e,s,n,r){if(h.length===0)return;let i=0,o=0;for(let a=0;a<h.length;a+=2)i+=h[a],o+=h[a+1];i/=h.length/2,o/=h.length/2;let c=s;t[c*e]=i,t[c*e+1]=o;const l=c++;for(let a=0;a<h.length;a+=2)t[c*e]=h[a],t[c*e+1]=h[a+1],a>0&&(n[r++]=c,n[r++]=l,n[r++]=c-1),c++;n[r++]=l+1,n[r++]=l,n[r++]=c-1}},Se=1e-4,Bt=1e-4;function Ce(h){const t=h.length;if(t<6)return 1;let e=0;for(let s=0,n=h[t-2],r=h[t-1];s<t;s+=2){const i=h[s],o=h[s+1];e+=(i-n)*(o+r),n=i,r=o}return e<0?-1:1}function Lt(h,t,e,s,n,r,i,o){const c=h-e*n,l=t-s*n,a=h+e*r,u=t+s*r;let x,y;i?(x=s,y=-e):(x=-s,y=e);const f=c+x,g=l+y,d=a+x,b=u+y;return o.push(f,g),o.push(d,b),2}function X(h,t,e,s,n,r,i,o){const c=e-h,l=s-t;let a=Math.atan2(c,l),u=Math.atan2(n-h,r-t);o&&a<u?a+=Math.PI*2:!o&&a>u&&(u+=Math.PI*2);let x=a;const y=u-a,f=Math.abs(y),g=Math.sqrt(c*c+l*l),d=(15*f*Math.sqrt(g)/Math.PI>>0)+1,b=y/d;if(x+=b,o){i.push(h,t),i.push(e,s);for(let p=1,M=x;p<d;p++,M+=b)i.push(h,t),i.push(h+Math.sin(M)*g,t+Math.cos(M)*g);i.push(h,t),i.push(n,r)}else{i.push(e,s),i.push(h,t);for(let p=1,M=x;p<d;p++,M+=b)i.push(h+Math.sin(M)*g,t+Math.cos(M)*g),i.push(h,t);i.push(n,r),i.push(h,t)}return d*2}function ke(h,t,e,s,n,r,i,o,c){const l=Se;if(h.length===0)return;const a=t;let u=a.alignment;if(t.alignment!==.5){let R=Ce(h);e&&(R*=-1),u=(u-.5)*R+.5}const x=new J(h[0],h[1]),y=new J(h[h.length-2],h[h.length-1]),f=s,g=Math.abs(x.x-y.x)<l&&Math.abs(x.y-y.y)<l;if(f){h=h.slice(),g&&(h.pop(),h.pop(),y.set(h[h.length-2],h[h.length-1]));const R=(x.x+y.x)*.5,N=(y.y+x.y)*.5;h.unshift(R,N),h.push(R,N)}const d=n,b=h.length/2;let p=h.length;const M=d.length/2,P=a.width/2,v=P*P,G=a.miterLimit*a.miterLimit;let C=h[0],S=h[1],m=h[2],_=h[3],D=0,F=0,w=-(S-_),T=C-m,q=0,z=0,H=Math.sqrt(w*w+T*T);w/=H,T/=H,w*=P,T*=P;const qt=u,k=(1-qt)*2,I=qt*2;f||(a.cap==="round"?p+=X(C-w*(k-I)*.5,S-T*(k-I)*.5,C-w*k,S-T*k,C+w*I,S+T*I,d,!0)+2:a.cap==="square"&&(p+=Lt(C,S,w,T,k,I,!0,d))),d.push(C-w*k,S-T*k),d.push(C+w*I,S+T*I);for(let R=1;R<b-1;++R){C=h[(R-1)*2],S=h[(R-1)*2+1],m=h[R*2],_=h[R*2+1],D=h[(R+1)*2],F=h[(R+1)*2+1],w=-(S-_),T=C-m,H=Math.sqrt(w*w+T*T),w/=H,T/=H,w*=P,T*=P,q=-(_-F),z=m-D,H=Math.sqrt(q*q+z*z),q/=H,z/=H,q*=P,z*=P;const N=m-C,et=S-_,st=m-D,nt=F-_,zt=N*st+et*nt,ct=et*st-nt*N,rt=ct<0;if(Math.abs(ct)<.001*Math.abs(zt)){d.push(m-w*k,_-T*k),d.push(m+w*I,_+T*I),zt>=0&&(a.join==="round"?p+=X(m,_,m-w*k,_-T*k,m-q*k,_-z*k,d,!1)+4:p+=2,d.push(m-q*I,_-z*I),d.push(m+q*k,_+z*k));continue}const Dt=(-w+C)*(-T+_)-(-w+m)*(-T+S),At=(-q+D)*(-z+_)-(-q+m)*(-z+F),lt=(N*At-st*Dt)/ct,ut=(nt*Dt-et*At)/ct,xt=(lt-m)*(lt-m)+(ut-_)*(ut-_),W=m+(lt-m)*k,j=_+(ut-_)*k,$=m-(lt-m)*I,V=_-(ut-_)*I,te=Math.min(N*N+et*et,st*st+nt*nt),Ht=rt?k:I,ee=te+Ht*Ht*v;xt<=ee?a.join==="bevel"||xt/v>G?(rt?(d.push(W,j),d.push(m+w*I,_+T*I),d.push(W,j),d.push(m+q*I,_+z*I)):(d.push(m-w*k,_-T*k),d.push($,V),d.push(m-q*k,_-z*k),d.push($,V)),p+=2):a.join==="round"?rt?(d.push(W,j),d.push(m+w*I,_+T*I),p+=X(m,_,m+w*I,_+T*I,m+q*I,_+z*I,d,!0)+4,d.push(W,j),d.push(m+q*I,_+z*I)):(d.push(m-w*k,_-T*k),d.push($,V),p+=X(m,_,m-w*k,_-T*k,m-q*k,_-z*k,d,!1)+4,d.push(m-q*k,_-z*k),d.push($,V)):(d.push(W,j),d.push($,V)):(d.push(m-w*k,_-T*k),d.push(m+w*I,_+T*I),a.join==="round"?rt?p+=X(m,_,m+w*I,_+T*I,m+q*I,_+z*I,d,!0)+2:p+=X(m,_,m-w*k,_-T*k,m-q*k,_-z*k,d,!1)+2:a.join==="miter"&&xt/v<=G&&(rt?(d.push($,V),d.push($,V)):(d.push(W,j),d.push(W,j)),p+=2),d.push(m-q*k,_-z*k),d.push(m+q*I,_+z*I),p+=2)}C=h[(b-2)*2],S=h[(b-2)*2+1],m=h[(b-1)*2],_=h[(b-1)*2+1],w=-(S-_),T=C-m,H=Math.sqrt(w*w+T*T),w/=H,T/=H,w*=P,T*=P,d.push(m-w*k,_-T*k),d.push(m+w*I,_+T*I),f||(a.cap==="round"?p+=X(m-w*(k-I)*.5,_-T*(k-I)*.5,m-w*k,_-T*k,m+w*I,_+T*I,d,!1)+2:a.cap==="square"&&(p+=Lt(m,_,w,T,k,I,!1,d)));const Ot=Bt*Bt;for(let R=M;R<p+M-2;++R)C=d[R*2],S=d[R*2+1],m=d[(R+1)*2],_=d[(R+1)*2+1],D=d[(R+2)*2],F=d[(R+2)*2+1],!(Math.abs(C*(_-F)+m*(F-S)+D*(S-_))<Ot)&&o.push(R,R+1,R+2)}function Xt(h,t,e,s,n,r,i){const o=se(h,t,2);if(!o)return;for(let l=0;l<o.length;l+=3)r[i++]=o[l]+n,r[i++]=o[l+1]+n,r[i++]=o[l+2]+n;let c=n*s;for(let l=0;l<h.length;l+=2)e[c]=h[l],e[c+1]=h[l+1],c+=s}const Te=[],we={build(h,t){for(let e=0;e<h.points.length;e++)t[e]=h.points[e];return t},triangulate(h,t,e,s,n,r){Xt(h,Te,t,e,s,n,r)}},ve={build(h,t){const e=h,s=e.x,n=e.y,r=e.width,i=e.height;return r>=0&&i>=0&&(t[0]=s,t[1]=n,t[2]=s+r,t[3]=n,t[4]=s+r,t[5]=n+i,t[6]=s,t[7]=n+i),t},triangulate(h,t,e,s,n,r){let i=0;s*=e,t[s+i]=h[0],t[s+i+1]=h[1],i+=e,t[s+i]=h[2],t[s+i+1]=h[3],i+=e,t[s+i]=h[6],t[s+i+1]=h[7],i+=e,t[s+i]=h[4],t[s+i+1]=h[5],i+=e;const o=s/e;n[r++]=o,n[r++]=o+1,n[r++]=o+2,n[r++]=o+1,n[r++]=o+3,n[r++]=o+2}},Ie={build(h,t){return t[0]=h.x,t[1]=h.y,t[2]=h.x2,t[3]=h.y2,t[4]=h.x3,t[5]=h.y3,t},triangulate(h,t,e,s,n,r){let i=0;s*=e,t[s+i]=h[0],t[s+i+1]=h[1],i+=e,t[s+i]=h[2],t[s+i+1]=h[3],i+=e,t[s+i]=h[4],t[s+i+1]=h[5];const o=s/e;n[r++]=o,n[r++]=o+1,n[r++]=o+2}},It={rectangle:ve,polygon:we,triangle:Ie,circle:mt,ellipse:mt,roundedRectangle:mt},Ge=new Z;function Re(h){const n={vertices:[],uvs:[],indices:[]},r=[];for(let i=0;i<h.instructions.length;i++){const o=h.instructions[i];if(o.action==="texture")qe(o.data,r,n);else if(o.action==="fill"||o.action==="stroke"){const c=o.action==="stroke",l=o.data.path.shapePath,a=o.data.style,u=o.data.hole;c&&u&&Ut(u.shapePath,a,null,!0,r,n),Ut(l,a,u,c,r,n)}}return r}function qe(h,t,e){const{vertices:s,uvs:n,indices:r}=e,i=r.length,o=s.length/2,c=[],l=It.rectangle,a=Ge,u=h.image;a.x=h.dx,a.y=h.dy,a.width=h.dw,a.height=h.dh;const x=h.transform;l.build(a,c),x&&$t(c,x),l.triangulate(c,s,2,o,r,i);const y=u.uvs;n.push(y.x0,y.y0,y.x1,y.y1,y.x3,y.y3,y.x2,y.y2);const f=Y.get(Vt);f.indexOffset=i,f.indexSize=r.length-i,f.vertexOffset=o,f.vertexSize=s.length/2-o,f.color=h.style,f.alpha=h.alpha,f.texture=u,f.geometryData=e,t.push(f)}function Ut(h,t,e,s,n,r){const{vertices:i,uvs:o,indices:c}=r,l=h.shapePrimitives.length-1;h.shapePrimitives.forEach(({shape:a,transform:u},x)=>{const y=c.length,f=i.length/2,g=[],d=It[a.type];if(d.build(a,g),u&&$t(g,u),s){const P=a.closePath??!0;ke(g,t,!1,P,i,2,f,c)}else if(e&&l===x){l!==0&&console.warn("[Pixi Graphics] only the last shape have be cut out");const P=[],v=g.slice();ze(e.shapePath).forEach(C=>{P.push(v.length/2),v.push(...C)}),Xt(v,P,i,2,f,c,y)}else d.triangulate(g,i,2,f,c,y);const b=o.length/2,p=t.texture;if(p!==O.WHITE){const P=t.matrix;u&&P.append(u.clone().invert()),Pe(i,2,f,o,b,2,i.length/2-f,P)}else Me(o,b,2,i.length/2-f);const M=Y.get(Vt);M.indexOffset=y,M.indexSize=c.length-y,M.vertexOffset=f,M.vertexSize=i.length/2-f,M.color=t.color,M.alpha=t.alpha,M.texture=p,M.geometryData=r,n.push(M)})}function ze(h){if(!h)return[];const t=h.shapePrimitives,e=[];for(let s=0;s<t.length;s++){const n=t[s].shape,r=[];It[n.type].build(n,r),e.push(r)}return e}class De{}class Ae{constructor(){this.geometry=new ue,this.instructions=new ne}init(){this.instructions.reset()}}const Gt=class Pt{constructor(){this._activeBatchers=[],this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._needsContextNeedsRebuild=[]}init(t){Pt.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??Pt.defaultOptions.bezierSmoothness}prerender(){this._returnActiveBatchers()}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t);const s=Re(t);let n=0;const r=t.batchMode;let i=!0;if(t.customShader||r==="no-batch")i=!1;else if(r==="auto"){for(let o=0;o<s.length;o++)if(n+=s[o].vertexSize,n>400){i=!1;break}}e=this._gpuContextHash[t.uid]={isBatchable:i,batches:s},t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_returnActiveBatchers(){for(let t=0;t<this._activeBatchers.length;t++)Y.return(this._activeBatchers[t]);this._activeBatchers.length=0}_initContextRenderData(t){const e=Y.get(Ae),s=this._gpuContextHash[t.uid].batches;let n=0,r=0;s.forEach(l=>{l.applyTransform=!1,n+=l.geometryData.vertices.length,r+=l.geometryData.indices.length});const i=Y.get(le);this._activeBatchers.push(i),i.ensureAttributeBuffer(n),i.ensureIndexBuffer(r),i.begin();for(let l=0;l<s.length;l++){const a=s[l];i.add(a)}i.finish(e.instructions);const o=e.geometry;o.indexBuffer.setDataWithSize(i.indexBuffer,i.indexSize,!0),o.buffers[0].setDataWithSize(i.attributeBuffer.float32View,i.attributeSize,!0);const c=i.batches;for(let l=0;l<c.length;l++){const a=c[l];a.bindGroup=de(a.textures.textures,a.textures.count)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new De;return this._gpuContextHash[t.uid]=e,t.on("update",this.onGraphicsContextUpdate,this),t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextUpdate(t){this._needsContextNeedsRebuild.push(t)}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("update",this.onGraphicsContextUpdate,this),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(Y.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(s=>{Y.return(s)})}destroy(){for(const t of this._needsContextNeedsRebuild)this._gpuContextHash[t.uid]&&this.onGraphicsContextDestroy(t);this._needsContextNeedsRebuild.length=0}};Gt.extension={type:[pt.WebGLSystem,pt.WebGPUSystem,pt.CanvasSystem],name:"graphicsContext"};Gt.defaultOptions={bezierSmoothness:.5};let Yt=Gt;const He=8,ft=11920929e-14,Be=1;function Qt(h,t,e,s,n,r,i,o,c,l){const u=Math.min(.99,Math.max(0,l??Yt.defaultOptions.bezierSmoothness));let x=(Be-u)/1;return x*=x,Le(t,e,s,n,r,i,o,c,h,x),h}function Le(h,t,e,s,n,r,i,o,c,l){Mt(h,t,e,s,n,r,i,o,c,l,0),c.push(i,o)}function Mt(h,t,e,s,n,r,i,o,c,l,a){if(a>He)return;const u=(h+e)/2,x=(t+s)/2,y=(e+n)/2,f=(s+r)/2,g=(n+i)/2,d=(r+o)/2,b=(u+y)/2,p=(x+f)/2,M=(y+g)/2,P=(f+d)/2,v=(b+M)/2,G=(p+P)/2;if(a>0){let C=i-h,S=o-t;const m=Math.abs((e-i)*S-(s-o)*C),_=Math.abs((n-i)*S-(r-o)*C);if(m>ft&&_>ft){if((m+_)*(m+_)<=l*(C*C+S*S)){c.push(v,G);return}}else if(m>ft){if(m*m<=l*(C*C+S*S)){c.push(v,G);return}}else if(_>ft){if(_*_<=l*(C*C+S*S)){c.push(v,G);return}}else if(C=v-(h+i)/2,S=G-(t+o)/2,C*C+S*S<=l){c.push(v,G);return}}Mt(h,t,u,x,b,p,v,G,c,l,a+1),Mt(v,G,M,P,g,d,i,o,c,l,a+1)}const Ue=8,Fe=11920929e-14,Ee=1;function Ne(h,t,e,s,n,r,i,o){const l=Math.min(.99,Math.max(0,o??Yt.defaultOptions.bezierSmoothness));let a=(Ee-l)/1;return a*=a,We(t,e,s,n,r,i,h,a),h}function We(h,t,e,s,n,r,i,o){St(i,h,t,e,s,n,r,o,0),i.push(n,r)}function St(h,t,e,s,n,r,i,o,c){if(c>Ue)return;const l=(t+s)/2,a=(e+n)/2,u=(s+r)/2,x=(n+i)/2,y=(l+u)/2,f=(a+x)/2;let g=r-t,d=i-e;const b=Math.abs((s-r)*d-(n-i)*g);if(b>Fe){if(b*b<=o*(g*g+d*d)){h.push(y,f);return}}else if(g=y-(t+r)/2,d=f-(e+i)/2,g*g+d*d<=o){h.push(y,f);return}St(h,t,e,l,a,y,f,o,c+1),St(h,y,f,u,x,r,i,o,c+1)}function Zt(h,t,e,s,n,r,i,o){let c=Math.abs(n-r);(!i&&n>r||i&&r>n)&&(c=2*Math.PI-c),o=o||Math.max(6,Math.floor(6*Math.pow(s,1/3)*(c/Math.PI))),o=Math.max(o,3);let l=c/o,a=n;l*=i?-1:1;for(let u=0;u<o+1;u++){const x=Math.cos(a),y=Math.sin(a),f=t+x*s,g=e+y*s;h.push(f,g),a+=l}}function je(h,t,e,s,n,r){const i=h[h.length-2],c=h[h.length-1]-e,l=i-t,a=n-e,u=s-t,x=Math.abs(c*u-l*a);if(x<1e-8||r===0){(h[h.length-2]!==t||h[h.length-1]!==e)&&h.push(t,e);return}const y=c*c+l*l,f=a*a+u*u,g=c*a+l*u,d=r*Math.sqrt(y)/x,b=r*Math.sqrt(f)/x,p=d*g/y,M=b*g/f,P=d*u+b*l,v=d*a+b*c,G=l*(b+p),C=c*(b+p),S=u*(d+M),m=a*(d+M),_=Math.atan2(C-v,G-P),D=Math.atan2(m-v,S-P);Zt(h,P+t,v+e,r,_,D,l*a>u*c)}const ht=Math.PI*2,_t={centerX:0,centerY:0,ang1:0,ang2:0},bt=({x:h,y:t},e,s,n,r,i,o,c)=>{h*=e,t*=s;const l=n*h-r*t,a=r*h+n*t;return c.x=l+i,c.y=a+o,c};function $e(h,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),s=t===1.5707963267948966?.551915024494:e,n=Math.cos(h),r=Math.sin(h),i=Math.cos(h+t),o=Math.sin(h+t);return[{x:n-r*s,y:r+n*s},{x:i+o*s,y:o-i*s},{x:i,y:o}]}const Ft=(h,t,e,s)=>{const n=h*s-t*e<0?-1:1;let r=h*e+t*s;return r>1&&(r=1),r<-1&&(r=-1),n*Math.acos(r)},Ve=(h,t,e,s,n,r,i,o,c,l,a,u,x)=>{const y=Math.pow(n,2),f=Math.pow(r,2),g=Math.pow(a,2),d=Math.pow(u,2);let b=y*f-y*d-f*g;b<0&&(b=0),b/=y*d+f*g,b=Math.sqrt(b)*(i===o?-1:1);const p=b*n/r*u,M=b*-r/n*a,P=l*p-c*M+(h+e)/2,v=c*p+l*M+(t+s)/2,G=(a-p)/n,C=(u-M)/r,S=(-a-p)/n,m=(-u-M)/r,_=Ft(1,0,G,C);let D=Ft(G,C,S,m);o===0&&D>0&&(D-=ht),o===1&&D<0&&(D+=ht),x.centerX=P,x.centerY=v,x.ang1=_,x.ang2=D};function Xe(h,t,e,s,n,r,i,o=0,c=0,l=0){if(r===0||i===0)return;const a=Math.sin(o*ht/360),u=Math.cos(o*ht/360),x=u*(t-s)/2+a*(e-n)/2,y=-a*(t-s)/2+u*(e-n)/2;if(x===0&&y===0)return;r=Math.abs(r),i=Math.abs(i);const f=Math.pow(x,2)/Math.pow(r,2)+Math.pow(y,2)/Math.pow(i,2);f>1&&(r*=Math.sqrt(f),i*=Math.sqrt(f)),Ve(t,e,s,n,r,i,c,l,a,u,x,y,_t);let{ang1:g,ang2:d}=_t;const{centerX:b,centerY:p}=_t;let M=Math.abs(d)/(ht/4);Math.abs(1-M)<1e-7&&(M=1);const P=Math.max(Math.ceil(M),1);d/=P;let v=h[h.length-2],G=h[h.length-1];const C={x:0,y:0};for(let S=0;S<P;S++){const m=$e(g,d),{x:_,y:D}=bt(m[0],r,i,u,a,b,p,C),{x:F,y:w}=bt(m[1],r,i,u,a,b,p,C),{x:T,y:q}=bt(m[2],r,i,u,a,b,p,C);Qt(h,v,G,_,D,F,w,T,q),v=T,G=q,g+=d}}function Ye(h,t,e){const s=(i,o)=>{const c=o.x-i.x,l=o.y-i.y,a=Math.sqrt(c*c+l*l),u=c/a,x=l/a;return{len:a,nx:u,ny:x}},n=(i,o)=>{i===0?h.moveTo(o.x,o.y):h.lineTo(o.x,o.y)};let r=t[t.length-1];for(let i=0;i<t.length;i++){const o=t[i%t.length],c=o.radius??e;if(c<=0){n(i,o),r=o;continue}const l=t[(i+1)%t.length],a=s(o,r),u=s(o,l);if(a.len<1e-4||u.len<1e-4){n(i,o),r=o;continue}let x=Math.asin(a.nx*u.ny-a.ny*u.nx),y=1,f=!1;a.nx*u.nx-a.ny*-u.ny<0?x<0?x=Math.PI+x:(x=Math.PI-x,y=-1,f=!0):x>0&&(y=-1,f=!0);const g=x/2;let d,b=Math.abs(Math.cos(g)*c/Math.sin(g));b>Math.min(a.len/2,u.len/2)?(b=Math.min(a.len/2,u.len/2),d=Math.abs(b*Math.sin(g)/Math.cos(g))):d=c;const p=o.x+u.nx*b+-u.ny*d*y,M=o.y+u.ny*b+u.nx*d*y,P=Math.atan2(a.ny,a.nx)+Math.PI/2*y,v=Math.atan2(u.ny,u.nx)-Math.PI/2*y;i===0&&h.moveTo(p+Math.cos(P)*d,M+Math.sin(P)*d),h.arc(p,M,d,P,v,f),r=o}}function Qe(h,t,e,s){const n=(o,c)=>Math.sqrt((o.x-c.x)**2+(o.y-c.y)**2),r=(o,c,l)=>({x:o.x+(c.x-o.x)*l,y:o.y+(c.y-o.y)*l}),i=t.length;for(let o=0;o<i;o++){const c=t[(o+1)%i],l=c.radius??e;if(l<=0){o===0?h.moveTo(c.x,c.y):h.lineTo(c.x,c.y);continue}const a=t[o],u=t[(o+2)%i],x=n(a,c);let y;if(x<1e-4)y=c;else{const d=Math.min(x/2,l);y=r(c,a,d/x)}const f=n(u,c);let g;if(f<1e-4)g=c;else{const d=Math.min(f/2,l);g=r(c,u,d/f)}o===0?h.moveTo(y.x,y.y):h.lineTo(y.x,y.y),h.quadraticCurveTo(c.x,c.y,g.x,g.y,s)}}const Ze=new Z;class Ke{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new jt,this._graphicsPath2D=t}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const s=this._currentPoly.points,n=s[s.length-2],r=s[s.length-1];return(n!==t||r!==e)&&s.push(t,e),this}arc(t,e,s,n,r,i){this._ensurePoly(!1);const o=this._currentPoly.points;return Zt(o,t,e,s,n,r,i),this}arcTo(t,e,s,n,r){this._ensurePoly();const i=this._currentPoly.points;return je(i,t,e,s,n,r),this}arcToSvg(t,e,s,n,r,i,o){const c=this._currentPoly.points;return Xe(c,this._currentPoly.lastX,this._currentPoly.lastY,i,o,t,e,s,n,r),this}bezierCurveTo(t,e,s,n,r,i,o){this._ensurePoly();const c=this._currentPoly;return Qt(this._currentPoly.points,c.lastX,c.lastY,t,e,s,n,r,i,o),this}quadraticCurveTo(t,e,s,n,r){this._ensurePoly();const i=this._currentPoly;return Ne(this._currentPoly.points,i.lastX,i.lastY,t,e,s,n,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));for(let s=0;s<t.instructions.length;s++){const n=t.instructions[s];this[n.action](...n.data)}return this}finish(t=!1){this.endPoly(t)}rect(t,e,s,n,r){return this.drawShape(new Z(t,e,s,n),r),this}circle(t,e,s,n){return this.drawShape(new Tt(t,e,s),n),this}poly(t,e,s){const n=new at(t);return n.closePath=e,this.drawShape(n,s),this}regularPoly(t,e,s,n,r=0,i){n=Math.max(n|0,3);const o=-1*Math.PI/2+r,c=Math.PI*2/n,l=[];for(let a=0;a<n;a++){const u=a*c+o;l.push(t+s*Math.cos(u),e+s*Math.sin(u))}return this.poly(l,!0,i),this}roundPoly(t,e,s,n,r,i=0,o){if(n=Math.max(n|0,3),r<=0)return this.regularPoly(t,e,s,n,i);const c=s*Math.sin(Math.PI/n)-.001;r=Math.min(r,c);const l=-1*Math.PI/2+i,a=Math.PI*2/n,u=(n-2)*Math.PI/n/2;for(let x=0;x<n;x++){const y=x*a+l,f=t+s*Math.cos(y),g=e+s*Math.sin(y),d=y+Math.PI+u,b=y-Math.PI-u,p=f+r*Math.cos(d),M=g+r*Math.sin(d),P=f+r*Math.cos(b),v=g+r*Math.sin(b);x===0?this.moveTo(p,M):this.lineTo(p,M),this.quadraticCurveTo(f,g,P,v,o)}return this.closePath()}roundShape(t,e,s=!1,n){return t.length<3?this:(s?Qe(this,t,e,n):Ye(this,t,e),this.closePath())}filletRect(t,e,s,n,r){if(r===0)return this.rect(t,e,s,n);const i=Math.min(s,n)/2,o=Math.min(i,Math.max(-i,r)),c=t+s,l=e+n,a=o<0?-o:0,u=Math.abs(o);return this.moveTo(t,e+u).arcTo(t+a,e+a,t+u,e,u).lineTo(c-u,e).arcTo(c-a,e+a,c,e+u,u).lineTo(c,l-u).arcTo(c-a,l-a,t+s-u,l,u).lineTo(t+u,l).arcTo(t+a,l-a,t,l-u,u).closePath()}chamferRect(t,e,s,n,r,i){if(r<=0)return this.rect(t,e,s,n);const o=Math.min(r,Math.min(s,n)/2),c=t+s,l=e+n,a=[t+o,e,c-o,e,c,e+o,c,l-o,c-o,l,t+o,l,t,l-o,t,e+o];for(let u=a.length-1;u>=2;u-=2)a[u]===a[u-2]&&a[u-1]===a[u-3]&&a.splice(u-1,2);return this.poly(a,!0,i)}ellipse(t,e,s,n,r){return this.drawShape(new wt(t,e,s,n),r),this}roundRect(t,e,s,n,r,i){return this.drawShape(new vt(t,e,s,n,r),i),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let s=this._currentPoly;return s&&this.endPoly(),s=new at,s.points.push(t,e),this._currentPoly=s,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new at,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let s=e.shape.x,n=e.shape.y;if(!e.transform.isIdentity()){const r=e.transform,i=s;s=r.a*s+r.c*n+r.tx,n=r.b*i+r.d*n+r.ty}this._currentPoly.points.push(s,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const s=t.instructions[e];this[s.action](...s.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let s=0;s<e.length;s++){const n=e[s],r=n.shape.getBounds(Ze);n.transform?t.addRect(r,n.transform):t.addRect(r)}return t}}class tt{constructor(t){this.instructions=[],this.uid=yt("graphicsPath"),this._dirty=!0,typeof t=="string"?_e(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new Ke(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,s,n,r){const i=this.instructions[this.instructions.length-1],o=this.getLastPoint(J.shared);let c=0,l=0;if(!i||i.action!=="bezierCurveTo")c=o.x,l=o.y;else{c=i.data[2],l=i.data[3];const a=o.x,u=o.y;c=a+(a-c),l=u+(u-l)}return this.instructions.push({action:"bezierCurveTo",data:[c,l,t,e,s,n,r]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,s){const n=this.instructions[this.instructions.length-1],r=this.getLastPoint(J.shared);let i=0,o=0;if(!n||n.action!=="quadraticCurveTo")i=r.x,o=r.y;else{i=n.data[0],o=n.data[1];const c=r.x,l=r.y;i=c+(c-i),o=l+(l-o)}return this.instructions.push({action:"quadraticCurveTo",data:[i,o,t,e,s]}),this._dirty=!0,this}rect(t,e,s,n,r){return this.instructions.push({action:"rect",data:[t,e,s,n,r]}),this._dirty=!0,this}circle(t,e,s,n){return this.instructions.push({action:"circle",data:[t,e,s,n]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,s,n,r,i,o){r=r||n/2;const c=-1*Math.PI/2+i,l=s*2,a=Math.PI*2/l,u=[];for(let x=0;x<l;x++){const y=x%2?r:n,f=x*a+c;u.push(t+y*Math.cos(f),e+y*Math.sin(f))}return this.poly(u,!0,o),this}clone(t=!1){const e=new tt;if(!t)e.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const n=this.instructions[s];e.instructions.push({action:n.action,data:n.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,s=t.b,n=t.c,r=t.d,i=t.tx,o=t.ty;let c=0,l=0,a=0,u=0,x=0,y=0,f=0,g=0;for(let d=0;d<this.instructions.length;d++){const b=this.instructions[d],p=b.data;switch(b.action){case"moveTo":case"lineTo":c=p[0],l=p[1],p[0]=e*c+n*l+i,p[1]=s*c+r*l+o;break;case"bezierCurveTo":a=p[0],u=p[1],x=p[2],y=p[3],c=p[4],l=p[5],p[0]=e*a+n*u+i,p[1]=s*a+r*u+o,p[2]=e*x+n*y+i,p[3]=s*x+r*y+o,p[4]=e*c+n*l+i,p[5]=s*c+r*l+o;break;case"quadraticCurveTo":a=p[0],u=p[1],c=p[2],l=p[3],p[0]=e*a+n*u+i,p[1]=s*a+r*u+o,p[2]=e*c+n*l+i,p[3]=s*c+r*l+o;break;case"arcToSvg":c=p[5],l=p[6],f=p[0],g=p[1],p[0]=e*f+n*g,p[1]=s*f+r*g,p[5]=e*c+n*l+i,p[6]=s*c+r*l+o;break;case"circle":p[4]=it(p[3],t);break;case"rect":p[4]=it(p[4],t);break;case"ellipse":p[8]=it(p[8],t);break;case"roundRect":p[5]=it(p[5],t);break;case"addPath":p[0].transform(t);break;case"poly":p[2]=it(p[2],t);break;default:Wt("unknown transform action",b.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,s=this.instructions[e];if(!s)return t.x=0,t.y=0,t;for(;s.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;s=this.instructions[e]}switch(s.action){case"moveTo":case"lineTo":t.x=s.data[0],t.y=s.data[1];break;case"quadraticCurveTo":t.x=s.data[2],t.y=s.data[3];break;case"bezierCurveTo":t.x=s.data[4],t.y=s.data[5];break;case"arc":case"arcToSvg":t.x=s.data[5],t.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(t);break}return t}}function it(h,t){return h?h.prepend(t):t.clone()}function Je(h,t){if(typeof h=="string"){const s=document.createElement("div");s.innerHTML=h.trim(),h=s.querySelector("svg")}const e={context:t,path:new tt};return Kt(h,e,null,null),t}function Kt(h,t,e,s){const n=h.children,{fillStyle:r,strokeStyle:i}=Oe(h);r&&e?e={...e,...r}:r&&(e=r),i&&s?s={...s,...i}:i&&(s=i),t.context.fillStyle=e,t.context.strokeStyle=s;let o,c,l,a,u,x,y,f,g,d,b,p,M,P,v,G,C;switch(h.nodeName.toLowerCase()){case"path":P=h.getAttribute("d"),v=new tt(P),t.context.path(v),e&&t.context.fill(),s&&t.context.stroke();break;case"circle":y=A(h,"cx",0),f=A(h,"cy",0),g=A(h,"r",0),t.context.ellipse(y,f,g,g),e&&t.context.fill(),s&&t.context.stroke();break;case"rect":o=A(h,"x",0),c=A(h,"y",0),G=A(h,"width",0),C=A(h,"height",0),d=A(h,"rx",0),b=A(h,"ry",0),d||b?t.context.roundRect(o,c,G,C,d||b):t.context.rect(o,c,G,C),e&&t.context.fill(),s&&t.context.stroke();break;case"ellipse":y=A(h,"cx",0),f=A(h,"cy",0),d=A(h,"rx",0),b=A(h,"ry",0),t.context.beginPath(),t.context.ellipse(y,f,d,b),e&&t.context.fill(),s&&t.context.stroke();break;case"line":l=A(h,"x1",0),a=A(h,"y1",0),u=A(h,"x2",0),x=A(h,"y2",0),t.context.beginPath(),t.context.moveTo(l,a),t.context.lineTo(u,x),s&&t.context.stroke();break;case"polygon":M=h.getAttribute("points"),p=M.match(/\d+/g).map(S=>parseInt(S,10)),t.context.poly(p,!0),e&&t.context.fill(),s&&t.context.stroke();break;case"polyline":M=h.getAttribute("points"),p=M.match(/\d+/g).map(S=>parseInt(S,10)),t.context.poly(p,!1),s&&t.context.stroke();break;case"g":case"svg":break;default:{console.info(`[SVG parser] <${h.nodeName}> elements unsupported`);break}}for(let S=0;S<n.length;S++)Kt(n[S],t,e,s)}function A(h,t,e){const s=h.getAttribute(t);return s?Number(s):e}function Oe(h){const t=h.getAttribute("style"),e={},s={};let n=!1,r=!1;if(t){const i=t.split(";");for(let o=0;o<i.length;o++){const c=i[o],[l,a]=c.split(":");switch(l){case"stroke":a!=="none"&&(e.color=E.shared.setValue(a).toNumber(),r=!0);break;case"stroke-width":e.width=Number(a);break;case"fill":a!=="none"&&(n=!0,s.color=E.shared.setValue(a).toNumber());break;case"fill-opacity":s.alpha=Number(a);break;case"stroke-opacity":e.alpha=Number(a);break;case"opacity":s.alpha=Number(a),e.alpha=Number(a);break}}}else{const i=h.getAttribute("stroke");i&&i!=="none"&&(r=!0,e.color=E.shared.setValue(i).toNumber(),e.width=A(h,"stroke-width",1));const o=h.getAttribute("fill");o&&o!=="none"&&(n=!0,s.color=E.shared.setValue(o).toNumber())}return{strokeStyle:r?e:null,fillStyle:n?s:null}}const Jt=class Ct{constructor(t,e,s,n){this.uid=yt("fillGradient"),this.type="linear",this.gradientStops=[],this.x0=t,this.y0=e,this.x1=s,this.y1=n}addColorStop(t,e){return this.gradientStops.push({offset:t,color:E.shared.setValue(e).toHex()}),this}buildLinearGradient(){const t=Ct.defaultTextureSize,{gradientStops:e}=this,s=re.get().createCanvas();s.width=t,s.height=t;const n=s.getContext("2d"),r=n.createLinearGradient(0,0,Ct.defaultTextureSize,1);for(let g=0;g<e.length;g++){const d=e[g];r.addColorStop(d.offset,d.color)}n.fillStyle=r,n.fillRect(0,0,t,t),this.texture=new O({source:new ie({resource:s,addressModeU:"clamp-to-edge",addressModeV:"repeat"})});const{x0:i,y0:o,x1:c,y1:l}=this,a=new Q,u=c-i,x=l-o,y=Math.sqrt(u*u+x*x),f=Math.atan2(x,u);a.translate(-i,-o),a.scale(1/t,1/t),a.rotate(-f),a.scale(256/y,1),this.transform=a}};Jt.defaultTextureSize=256;let ts=Jt;const Et={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class es{constructor(t,e){this.uid=yt("fillPattern"),this.transform=new Q,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=Et[e].addressModeU,t.source.style.addressModeV=Et[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height)}}function K(h,t){var i;if(h==null)return null;let e,s;if(h!=null&&h.fill?(s=h.fill,e={...t,...h}):(s=h,e=t),E.isColorLike(s)){const o=E.shared.setValue(s??0);return{...e,color:o.toNumber(),alpha:o.alpha===1?e.alpha:o.alpha,texture:O.WHITE}}else if(s instanceof es){const o=s;return{...e,color:16777215,texture:o.texture,matrix:o.transform,fill:e.fill??null}}else if(s instanceof ts){const o=s;return o.buildLinearGradient(),{...e,color:16777215,texture:o.texture,matrix:o.transform}}const n={...t,...h};if(n.texture){if(n.texture!==O.WHITE){const c=((i=n.matrix)==null?void 0:i.invert())||new Q;c.scale(1/n.texture.frame.width,1/n.texture.frame.height),n.matrix=c}const o=n.texture.source.style;o.addressMode==="clamp-to-edge"&&(o.addressMode="repeat")}const r=E.shared.setValue(n.color);return n.alpha*=r.alpha,n.color=r.toNumber(),n.matrix=n.matrix?n.matrix.clone():null,n}const ss=new J,Nt=new Q,Rt=class U extends oe{constructor(){super(...arguments),this.uid=yt("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new tt,this._transform=new Q,this._fillStyle={...U.defaultFillStyle},this._strokeStyle={...U.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new jt,this._boundsDirty=!0}clone(){const t=new U;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=K(t,U.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=K(t,U.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=K(t,U.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=K(t,U.defaultStrokeStyle),this}texture(t,e,s,n,r,i){return this.instructions.push({action:"texture",data:{image:t,dx:s||0,dy:n||0,dw:r||t.frame.width,dh:i||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?E.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new tt,this}fill(t,e){let s;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?s=n.data.path:s=this._activePath.clone(),s?(t&&(e!==void 0&&typeof t=="number"&&(B(L,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=K(t,U.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(J.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s&&s.action==="fill"?e=s.data.path:e=this._activePath.clone(),e?(t&&(this._strokeStyle=K(t,U.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],s=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(s);else{e.data.hole=s;break}}return this._initNextPathLocation(),this}arc(t,e,s,n,r,i){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,s,n,r,i),this}arcTo(t,e,s,n,r){this._tick++;const i=this._transform;return this._activePath.arcTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty,i.a*s+i.c*n+i.tx,i.b*s+i.d*n+i.ty,r),this}arcToSvg(t,e,s,n,r,i,o){this._tick++;const c=this._transform;return this._activePath.arcToSvg(t,e,s,n,r,c.a*i+c.c*o+c.tx,c.b*i+c.d*o+c.ty),this}bezierCurveTo(t,e,s,n,r,i,o){this._tick++;const c=this._transform;return this._activePath.bezierCurveTo(c.a*t+c.c*e+c.tx,c.b*t+c.d*e+c.ty,c.a*s+c.c*n+c.tx,c.b*s+c.d*n+c.ty,c.a*r+c.c*i+c.tx,c.b*r+c.d*i+c.ty,o),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,s,n){return this._tick++,this._activePath.ellipse(t,e,s,n,this._transform.clone()),this}circle(t,e,s){return this._tick++,this._activePath.circle(t,e,s,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty),this}moveTo(t,e){this._tick++;const s=this._transform,n=this._activePath.instructions,r=s.a*t+s.c*e+s.tx,i=s.b*t+s.d*e+s.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=r,n[0].data[1]=i,this):(this._activePath.moveTo(r,i),this)}quadraticCurveTo(t,e,s,n,r){this._tick++;const i=this._transform;this._activePath.quadraticCurveTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty,i.a*s+i.c*n+i.tx,i.b*s+i.d*n+i.ty,r)}rect(t,e,s,n){return this._tick++,this._activePath.rect(t,e,s,n,this._transform.clone()),this}roundRect(t,e,s,n,r){return this._tick++,this._activePath.roundRect(t,e,s,n,r,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,s,n,r=0,i){return this._tick++,this._activePath.regularPoly(t,e,s,n,r,i),this}roundPoly(t,e,s,n,r,i){return this._tick++,this._activePath.roundPoly(t,e,s,n,r,i),this}roundShape(t,e,s,n){return this._tick++,this._activePath.roundShape(t,e,s,n),this}filletRect(t,e,s,n,r){return this._tick++,this._activePath.filletRect(t,e,s,n,r),this}chamferRect(t,e,s,n,r,i){return this._tick++,this._activePath.chamferRect(t,e,s,n,r,i),this}star(t,e,s,n,r=0,i=0){return this._tick++,this._activePath.star(t,e,s,n,r,i,this._transform.clone()),this}svg(t){this._tick++,Je(t,this)}restore(){const t=this._stateStack.pop();t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle)}save(){this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}})}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,s,n,r,i){return t instanceof Q?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,s,n,r,i),this)}transform(t,e,s,n,r,i){return t instanceof Q?(this._transform.append(t),this):(Nt.set(t,e,s,n,r,i),this._transform.append(Nt),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const s=this.instructions[e],n=s.action;if(n==="fill"){const r=s.data;t.addBounds(r.path.bounds)}else if(n==="texture"){const r=s.data;t.addFrame(r.dx,r.dy,r.dx+r.dw,r.dy+r.dh,r.transform)}if(n==="stroke"){const r=s.data,i=r.style.width/2,o=r.path.bounds;t.addFrame(o.minX-i,o.minY-i,o.maxX+i,o.maxY+i)}}return t}containsPoint(t){var n;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let s=!1;for(let r=0;r<e.length;r++){const i=e[r],o=i.data,c=o.path;if(!i.action||!c)continue;const l=o.style,a=c.shapePath.shapePrimitives;for(let u=0;u<a.length;u++){const x=a[u].shape;if(!l||!x)continue;const y=a[u].transform,f=y?y.applyInverse(t,ss):t;i.action==="fill"?s=x.contains(f.x,f.y):s=x.strokeContains(f.x,f.y,l.width);const g=o.hole;if(g){const d=(n=g.shapePath)==null?void 0:n.shapePrimitives;if(d)for(let b=0;b<d.length;b++)d[b].shape.contains(f.x,f.y)&&(s=!1)}if(s)return!0}}return s}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(s),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(s)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Rt.defaultFillStyle={color:16777215,alpha:1,texture:O.WHITE,matrix:null,fill:null};Rt.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:O.WHITE,matrix:null,fill:null};let ot=Rt;class kt extends ae{constructor(t){t instanceof ot&&(t={context:t});const{context:e,roundPixels:s,...n}=t||{};super({label:"Graphics",...n}),this.canBundle=!0,this.renderPipeId="graphics",this._roundPixels=0,e?this._context=e:this._context=this._ownedContext=new ot,this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=s??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}addBounds(t){t.addBounds(this._context.bounds)}containsPoint(t){return this._context.containsPoint(t)}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}onViewUpdate(){this._didChangeId+=4096,this._didGraphicsUpdate=!0,!this.didViewUpdate&&(this.didViewUpdate=!0,this.renderGroup&&this.renderGroup.onChildViewUpdate(this))}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(...t){return this._callContextMethod("cut",t)}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(...t){return this._callContextMethod("closePath",t)}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(...t){return this._callContextMethod("save",t)}getTransform(...t){return this._callContextMethod("getTransform",t)}resetTransform(...t){return this._callContextMethod("resetTransform",t)}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(...t){return this._callContextMethod("clear",t)}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new kt(this._context.clone()):(this._ownedContext=null,new kt(this._context))}lineStyle(t,e,s){B(L,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),e&&(n.color=e),s&&(n.alpha=s),this.context.strokeStyle=n,this}beginFill(t,e){B(L,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return t&&(s.color=t),e&&(s.alpha=e),this.context.fillStyle=s,this}endFill(){B(L,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==ot.defaultStrokeStyle.width||t.color!==ot.defaultStrokeStyle.color||t.alpha!==ot.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return B(L,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return B(L,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return B(L,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return B(L,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return B(L,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return B(L,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}export{Vt as B,ts as F,kt as G,ot as a,es as b,K as c,Yt as d};
