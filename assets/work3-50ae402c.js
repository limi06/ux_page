var te=Object.defineProperty;var ie=(e,t,i)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var E=(e,t,i)=>(ie(e,typeof t!="symbol"?t+"":t,i),i);import{S,T as W,P as le}from"./index-aa1368c8.js";import{e as X,c as D,N as Q,a as fe,Q as se}from"./common-5afcdaa1.js";import{a as ne,b as ae,d as de,c as re,e as ge,u as oe}from"./currentBorder-bbf8dd09.js";import{B as ue}from"./index-f5c4909a.js";import{d as pe,r as I,a as we,o as he,c as ve,b as N,e as C,w as T,f as A}from"./index-0070c043.js";import{A as ce}from"./Application-27e46a22.js";import"./red2-282fd708.js";function Y(e){return e===1?2:1}function a(e){return e&&e.color===1}class me{constructor(){E(this,"color",1);E(this,"tag",[])}}function L(e,t){if(t.x>e[1])return"right";if(t.x+t.width<e[0])return"left";if(t.x<e[1]&&t.x>=e[0]&&t.x+t.width>e[1]){const i={...t,width:e[1]-t.x},f={...t,x:e[1],width:t.x+t.width-e[1]};return{type:"right",ary:[i,f]}}else if(t.x<=e[0]&&t.x+t.width>=e[0]&&t.x+t.width<e[1]){const i={...t,x:e[0],width:t.x+t.width-e[0]},f={...t,x:t.x,width:e[0]-t.x};return{type:"left",ary:[i,f]}}else return"equal"}function xe(e,t){if(t.y>e[1])return"right";if(t.y+t.height<e[0])return"left";if(t.y<e[1]&&t.y>=e[0]&&t.y+t.height>e[1]){const i={...t,height:e[1]-t.y},f={...t,y:e[1],height:t.y+t.height-e[1]};return{type:"right",ary:[i,f]}}else if(t.y<e[0]&&t.y+t.height>e[0]&&t.y+t.height<=e[1]){const i={...t,height:t.y+t.height-e[0],y:e[0]},f={...t,height:e[0]-t.y};return{type:"left",ary:[i,f]}}else return"equal"}function M(e,t,i){var u,w,v,r;if(!e){const n=new me;return n.color=1,n.datas=[t],i===L?n.tag=[t.x,t.x+t.width]:n.tag=[t.y,t.y+t.height],n.bounds=t,n.target=t.target,i===L&&(n.data=new G(xe),n.data.init(n.datas)),n}let f=i(e.tag,t);if(f=="right")e.right=M(e.right,t,i);else if(f=="left")e.left=M(e.left,t,i);else if(f=="equal")e.datas.push(t),(u=e.data)==null||u.add(t);else{const{type:n,ary:[d,p]}=f;n=="right"?(e.datas.push(d),(w=e.data)==null||w.add(d),e.right=M(e.right,p,i)):n=="left"&&(e.datas.push(d),(v=e.data)==null||v.add(d),e.left=M(e.left,p,i))}return a(e==null?void 0:e.right)&&!a(e==null?void 0:e.left)&&(e=O(e)),a(e==null?void 0:e.left)&&a((r=e==null?void 0:e.left)==null?void 0:r.left)&&(e=B(e)),a(e==null?void 0:e.left)&&a(e==null?void 0:e.right)&&q(e),e}function O(e){var f;const t=(f=e.right)==null?void 0:f.left,i=e.right;return e.right.left=e,e.right=t,e.color==2&&(i.color=2),e.color=1,e=i,e}function B(e){const t=e.left;return e.left=t==null?void 0:t.right,t.right=e,t.color=e.color,e.color=1,t}function q(e){e.color=Y(e.color),e.left&&(e.left.color=Y(e.left.color)),e.right&&(e.right.color=Y(e.right.color))}function P(e){var t;return e?(a(e.right)&&!a(e.lfet)&&(e=O(e)),a(e.left)&&a((t=e.left)==null?void 0:t.left)&&(e=B(e)),a(e.left)&&a(e.right)&&q(e),e):null}function U(e){return q(e),e.right&&a(e.right.left)&&(e.right=B(e.right)),e}function j(e){var t;return q(e),a(e.left)&&a((t=e.left)==null?void 0:t.left)&&(e=B(e),q(e)),e}function $(e){return e!=null&&e.left&&(e=$(e.left)),e}function z(e){var t;return e.left?(!a(e.left)&&!a((t=e.left)==null?void 0:t.left)&&(e=U(e)),e.left=z(e.left),P(e)):null}function _(e,t,i){var u,w,v,r,n,d;if(!e)return null;t.x==575&&t.y==550&&t.width==25&&t.height==100;let f=i(e.tag,t);if(f=="left")!a(e.left)&&!a((u=e.left)==null?void 0:u.left)&&(e=U(e)),e.left=_(e.left,t,i);else if(f=="right")a(e.left)&&!a(e.right)&&(e=B(e)),!a(e.right)&&!a((w=e.right)==null?void 0:w.left)&&(e=j(e)),e.right=_(e.right,t,i);else{if(a(e.left)&&!a(e.right))return e=B(e),e=_(e,t,i),P(e);if(e.right&&!a(e.right)&&!a((v=e.right)==null?void 0:v.left))return e=j(e),e=_(e,t,i),P(e);if(f=="equal"){const l=e.datas.findIndex(g=>X(g,t));e.datas.splice(l,1),i==L&&((r=e.data)==null||r.delete(t))}else{const{type:l,ary:[g,s]}=f;if(l=="right"){const o=e.datas.findIndex(c=>X(c,g));e.datas.splice(o,1),i==L&&((n=e.data)==null||n.delete(g)),e.right=_(e.right,s,i)}else if(l=="left"){const o=e.datas.findIndex(c=>X(c,g));e.datas.splice(o,1),i==L&&((d=e.data)==null||d.delete(g)),e.left=_(e.left,s,i)}}const p=$(e.right);p?(e.data=p.data,e.tag=p.tag,e.datas=p.datas,e.bounds=p.bounds,e.target=p.target,e.right=z(e.right)):e=null}return P(e)}class G{constructor(t){E(this,"root",null);E(this,"originDataAry",[]);E(this,"compareFn");this.compareFn=t||L}search(t){var v;if(!this.root)return;let i=[],f=null;function u(r,n){r&&(r.tag[0]<=t[n]&&r.tag[1]>=t[n]?n=="x"?f=r:n=="y"&&i.push(r):r.tag[0]>t[n]?u(r.left,n):u(r.right,n))}u(this.root,"x"),f&&u((v=f==null?void 0:f.data)==null?void 0:v.root,"y");let w=null;return i.find(r=>r.datas.find(d=>{if(d.y<=t.y&&d.y+d.height>=t.y&&d.x<=t.x&&d.x+d.width>=t.x)return w=d,!0})),w}init(t){this.originDataAry=[...t],t.map(i=>this.add(i))}add(t){this.root=M(this.root,t,this.compareFn),this.root.color=2}update(t,i){debugger;this.delete(t)}delete(t){this.root=_(this.root,t,this.compareFn),this.root&&(this.root.color=2)}}const ye=new G,m=D();function J(e){this.style.cursor="crosshair"}function K(e){const{pageX:t,pageY:i}=e,{x:f,y:u}=m.startPoint,w=m.pixiApp.canvas,v=w.offsetLeft,r=w.offsetTop;let{x:n,y:d,width:p,height:l}=fe({x:f,y:u,x2:t,y2:i});n=n-v,d=d-r,ge({x:n,y:d,width:p,height:l}),oe({x:n,y:d,width:p,height:l})}function _e(){m.status="";const e=m.pixiApp.canvas;e.removeEventListener("mouseenter",J),e.removeEventListener("mousedown",F),window.removeEventListener("mouseup",Z),window.removeEventListener("mousemove",K),e.style.cursor="auto"}function Z(e){var i;const t=m.currentNode;(i=m.quadTree)==null||i.add(new Q({x:t.x,y:t.y,width:t.width,height:t.height,target:t})),_e(),ne(),ae()}function F(e){de();const{pageX:t,pageY:i}=e;m.startPoint={x:t,y:i};const f=new S(W.WHITE);f.x=t,f.y=i,m.currentNode&&m.currentNode.removeAllListeners(),m.currentNode=f,m.pixiApp.stage.addChild(f),re(),window.addEventListener("mousemove",K)}function Ee(e){e.addEventListener("mouseenter",J),e.addEventListener("mousedown",F),window.addEventListener("mouseup",Z)}const Le={class:"nav_content flex items-center justify-center"},Be={class:"flex mt-[20px]"},Ce=N("div",{class:"w-[240px]"},null,-1),Te=N("div",{class:"w-[250px]"},null,-1),Ye=pe({__name:"work3",setup(e){const t=D(),i=I(),f=I();I([]);const u=I([]);we(async()=>{v()});function w(){var l;for(let g=0;g<5;g++){const s=new S(W.WHITE);s.width=Math.random()*260,s.height=Math.random()*290,s.x=Math.random()*(800-s.width),s.y=Math.random()*(800-s.height),s.tint="#abcdef",u.value.push(s),quadTree.add(new Q({x:s.x,y:s.y,width:s.width,height:s.height,target:s})),(l=i.value)==null||l.stage.addChild(s)}console.log(quadTree,"quadTree")}async function v(){var c,x;const l=new ce;i.value=l;const g=(c=f.value)==null?void 0:c.getAttribute("width");let s=800;g&&(s=parseInt(g)),window.__PIXI_APP__=l;const o=new se({x:0,y:0,width:s,height:800});t.quadTree=o,await l.init({width:s,height:800,background:"#EFEFEF",antialias:!0}),(x=f.value)==null||x.appendChild(l.canvas),t.pixiApp=l,l.stage.hitArea=l.screen,r()}function r(){var V;const l=new S(W.WHITE);let g=200;l.x=g;let s=200;l.y=s;let o=100;l.width=o;let c=100;l.height=c,l.tint="#E85858",(V=i.value)==null||V.stage.addChild(l),t.currentNode=l;let x,R;function k(h){var y;x=h.pageX,h.pageY,g=l.x,s=l.y,o=l.width,c=l.height,i.value.stage.eventMode="static",(y=i.value)==null||y.stage.addEventListener("pointermove",H)}function b(){let h=R-x;if(h=Math.floor(h),Math.abs(h)>=o&&h<0){l.x=g-(Math.abs(h)-o),l.width=Math.abs(h)-o;return}l.x=g,l.width=o+h}function H(h){let{pageX:y,pageY:Ae}=h;R=y,b()}function ee(h){var y;(y=i.value)==null||y.stage.removeEventListener("pointermove",H),window.removeEventListener("mousedown",k)}window.addEventListener("mousedown",k),window.addEventListener("mouseup",ee)}function n(){function l(g){const{offsetX:s,offsetY:o}=g,{pixiApp:c}=t;if(!c)return;const{stage:x}=c,{x:R,y:k}=x.toLocal(new le(s,o));console.log(R,k),console.log(s,o,"offsetX, offsetY"),window.removeEventListener("mouseup",l),r()}window.addEventListener("mouseup",l)}function d(){t.status="container",Ee(i.value.canvas)}function p(){console.log(ye.root,"redTree")}return(l,g)=>{const s=ue;return he(),ve("div",null,[N("div",Le,[C(s,{type:"info",onClick:n},{default:T(()=>[A("选择")]),_:1}),C(s,{type:"danger",onClick:d},{default:T(()=>[A("容器")]),_:1}),C(s,{type:"primary"},{default:T(()=>[A("矩形")]),_:1}),C(s,{type:"primary",onClick:w},{default:T(()=>[A("查看quad")]),_:1}),C(s,{type:"primary",onClick:p},{default:T(()=>[A("redTree")]),_:1})]),N("div",Be,[Ce,N("div",{ref_key:"container",ref:f,class:"container flex-1 bg-slate-300"},null,512),Te])])}}});export{Ye as default};
